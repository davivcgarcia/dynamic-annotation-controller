apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Production overlay for Dynamic Annotation Controller
namespace: dynamic-annotation-controller-system

# Base configuration
resources:
- ../default

# Production-specific patches
patches:
# Increase resource limits for production workload
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/cpu
      value: "2000m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/limits/memory
      value: "512Mi"
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/cpu
      value: "200m"
    - op: replace
      path: /spec/template/spec/containers/0/resources/requests/memory
      value: "256Mi"
  target:
    kind: Deployment
    name: controller-manager

# Enable leader election for HA
- patch: |-
    - op: add
      path: /spec/template/spec/containers/0/args/-
      value: "--leader-elect-lease-duration=30s"
    - op: add
      path: /spec/template/spec/containers/0/args/-
      value: "--leader-elect-renew-deadline=20s"
    - op: add
      path: /spec/template/spec/containers/0/args/-
      value: "--leader-elect-retry-period=5s"
  target:
    kind: Deployment
    name: controller-manager

# Set production replica count
- patch: |-
    - op: replace
      path: /spec/replicas
      value: 2
  target:
    kind: Deployment
    name: controller-manager

# Add production labels
commonLabels:
  environment: production
  tier: control-plane

# Add production annotations
commonAnnotations:
  deployment.kubernetes.io/revision: "1"
  config.kubernetes.io/origin: "kustomize"